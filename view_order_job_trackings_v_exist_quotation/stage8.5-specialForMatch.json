{
    $expr: {
      $and: [
        { $eq: ["$data.code", "Q2309-000166"] }
      ]
    }
  }



6.5
{
  $expr: {
    $and: [
      { $eq: ["$cart_order_no", "CO2309-000174"] },
      { $eq: ["$cart_order_no", "CO2309-000178"] }
    ]
  }
}

เผื่ออยาก debug contractor accept
somedude_1: "$jobs.contractor_accept",
somedude_2:
  "$jobs.contractor_accept.contractor_id",
somedude_3: {
  $arrayElemAt: ["$job.contractor_accept", 0],
},




             
                cart_order_no           data.code
install conf    CO2309-000178           Q2309-000169
cont no view    CO2309-000174           Q2309-000166


$and: [
  { $eq: ["jobs.contractor_accept.contractor_id", ""] },
  { $eq: ["jobs.contractor_accept", "null"] },
  { $eq: ["jobs.contractor_accept", null] },
]

ไปหาถามคนอื่นเถอะว่า bool state กาวๆยังงี้แม่ง alway true ได้ไง ทั้ง quotation ทั้ง con accept เลย



{
  $switch: {
    branches: [
      {
        case: {
          {
            $ne: [
              "$jobs.contractor_accept.contractor_id",
              "",
            ],
          },
        },
        then: true,
      },
      {
        case: {
          $eq: [
            "$$job.status",
            "survey_finished",
          ],
        },
        then: "request_quotation",
      },
      
    ],
    default: "$$job.status",
  },
},